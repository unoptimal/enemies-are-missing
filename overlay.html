<!doctype html>
<html>
  <head>
    <style>
      body {
        background: transparent;
        overflow: hidden;
        margin: 0;
      }
      video {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <video id="videoElement" autoplay preload="auto">
      <source src="" type="video/webm" />
    </video>
    <script>
      const video = document.querySelector('#videoElement')
      const source = video.querySelector('source')

      const audioContext = new AudioContext()
      const sourceNode = audioContext.createMediaElementSource(video)
      const gainNode = audioContext.createGain()

      const { ipcRenderer } = require('electron')

      Promise.all([
        ipcRenderer.invoke('get-volume'),
        ipcRenderer.invoke('get-size'),
      ]).then(([volume, size]) => {
        gainNode.gain.value = volume
        source.src = `ping-${size}.webm`
        video.load()
        video.play()
      })

      sourceNode.connect(gainNode)
      gainNode.connect(audioContext.destination)
    </script>
  </body>
</html>
